2016-03-03

金融审计系统故障处理：
sqlplus / as sysdba可以登录数据库
sqlplus dbsnmp/dbsnmp@naoceb无法登录数据库
以上两种操作都是在数据库服务器上直接执行。

检查监听状态：正常
tnsping naoceb：正常
查看alert日志，发现有报错，经查，该系统在登录数据库时有触发器，将用户的某些信息存入login_history表中，在该表中有一个字段PREV_SQL_ADDR raw(4),该字段存储v$session中的PREV_SQL_ADDR raw(8),报错信息正是login_history表PREV_SQL_ADDR字段太小，导致无法插入表login_history。因此怀疑登录时由于触发器执行失败导致无法登录。
但是，由于没有开发人员支持，不能完全确定。
后，查询半年前的alert日志，也发现有该错误。
..........
后，重启监听，重启后问题解决。


总结：从故障现象判断，是无法以网络方式登录数据库，而此种方式需要用到监听，虽然监听状态显示正常，但是当时并没有检查监听日志。
即便通过常规方法检查监听状态正常，但实际也未必，此奇葩之谓也！
后来根据alert日志的报错进行分析是偏离了问题的原因的，由于没有开发支持，不能准确判断触发器的失败是否影响正常登录。
由此看来，故障树的分析方法，有时未必适用，类似此种监听假活真死的情况，必须用大招了：重启！
